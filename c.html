<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nepali Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @media (max-width: 640px) {
            .calendar-cell {
                aspect-ratio: 1/1;
                font-size: 0.9rem;
            }
            .nepali-date {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="max-w-4xl mx-auto bg-white shadow-lg">
        <!-- Calendar Header -->
        <div class="p-4 border-b">
            <div class="flex justify-between items-center mb-4">
                <button id="prevMonth" class="text-red-600 hover:text-red-800 p-2">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="text-center">
                    <div class="flex gap-4 items-center">
                        <span class="text-lg font-medium text-red-600">Current Month</span>
                        
                    </div>
                </div>
                <button id="nextMonth" class="text-red-600 hover:text-red-800 p-2">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="text-center">
                <h2 id="currentMonth" class="text-xl font-bold"></h2>
                <p id="currentMonthNp" class="text-lg text-gray-600"></p>
            </div>
        </div>

        <!-- Calendar Grid -->
        <div class="p-2 md:p-4">
            <div class="grid grid-cols-7 gap-1 md:gap-2 mb-2">
                <div class="text-center p-2 text-gray-800 font-medium">Sun</div>
                <div class="text-center p-2 text-gray-800 font-medium">Mon</div>
                <div class="text-center p-2 text-gray-800 font-medium">Tue</div>
                <div class="text-center p-2 text-gray-800 font-medium">Wed</div>
                <div class="text-center p-2 text-gray-800 font-medium">Thu</div>
                <div class="text-center p-2 text-gray-800 font-medium">Fri</div>
                <div class="text-center p-2 text-red-600 font-medium">Sat</div>
            </div>
            <div id="calendarGrid" class="grid grid-cols-7 gap-1 md:gap-2"></div>
        </div>
    </div>

    <!-- Event Popup -->
    <div id="eventPopup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-4 max-w-md w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 id="popupDate" class="text-lg font-bold"></h3>
                <button onclick="closePopup()" class="text-gray-600 hover:text-gray-800">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="eventDetails" class="space-y-2"></div>
        </div>
    </div>

    <script>
        let currentDate = {
            year: 2081,
            month: 8,
            calendarData: null
        };

        async function fetchCalendarData() {
            const response = await fetch("https://api.saralpatro.com/graphql", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    query: `
                    {
                        dates(bsYear: ${currentDate.year}) {
                            bsDay
                            bsMonth
                            bsDayNp
                            bsMonthNp
                            weekday
                            isHoliday
                            events {
                                strEn
                                strNp
                                isHoliday
                            }
                        }
                    }
                    `
                })
            });

            const data = await response.json();
            currentDate.calendarData = data.data.dates;
            renderCalendar();
        }

        function createDateCell(date) {
            const cell = document.createElement('div');
            cell.className = `calendar-cell p-1 border rounded ${date.isHoliday ? 'bg-red-50' : 'bg-white'} 
                            hover:shadow-md transition-shadow cursor-pointer relative flex flex-col justify-between`;
            
            const hasEvents = date.events && date.events.length > 0;
            
            cell.innerHTML = `
                <div class="flex flex-col items-end">
                    <span class="${date.isHoliday ? 'text-red-600' : 'text-gray-800'} font-medium">
                        ${date.bsDay}
                    </span>
                    <span class="nepali-date text-gray-600">${date.bsDayNp}</span>
                </div>
                ${hasEvents ? '<div class="absolute bottom-1 right-1 text-blue-500"><i class="fas fa-circle text-xs"></i></div>' : ''}
            `;

            cell.onclick = () => showEventPopup(date);
            return cell;
        }

        function createEmptyCell() {
            const cell = document.createElement('div');
            cell.className = 'calendar-cell p-1 border rounded bg-gray-50';
            return cell;
        }

        function renderCalendar() {
            const monthData = currentDate.calendarData.filter(date => date.bsMonth === currentDate.month);
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            const firstDay = monthData[0].weekday;
            for (let i = 0; i < firstDay; i++) {
                grid.appendChild(createEmptyCell());
            }

            monthData.forEach(date => {
                grid.appendChild(createDateCell(date));
            });

            updateMonthHeader();
        }

        function showEventPopup(date) {
            const popup = document.getElementById('eventPopup');
            const popupDate = document.getElementById('popupDate');
            const eventDetails = document.getElementById('eventDetails');

            popupDate.textContent = `${date.bsDay}/${currentDate.month}/${currentDate.year}`;
            eventDetails.innerHTML = '';

            if (date.events && date.events.length > 0) {
                date.events.forEach(event => {
                    const eventDiv = document.createElement('div');
                    eventDiv.className = 'p-2 border rounded bg-gray-50';
                    eventDiv.innerHTML = `
                        <p class="text-gray-800">${event.strEn}</p>
                        <p class="text-gray-600 text-sm">${event.strNp}</p>
                    `;
                    eventDetails.appendChild(eventDiv);
                });
            } else {
                eventDetails.innerHTML = '<p class="text-gray-600">No events for this date</p>';
            }

            popup.classList.remove('hidden');
        }

        function closePopup() {
            document.getElementById('eventPopup').classList.add('hidden');
        }

        function updateMonthHeader() {
            const monthNames = [
                "Baisakh", "Jestha", "Ashadh", "Shrawan", "Bhadra", "Ashwin",
                "Kartik", "Mangsir", "Poush", "Magh", "Falgun", "Chaitra"
            ];
            const monthNamesNp = [
                "बैशाख", "जेठ", "असार", "श्रावण", "भदौ", "असोज",
                "कार्तिक", "मंसिर", "पुष", "माघ", "फागुन", "चैत्र"
            ];
            
            document.getElementById('currentMonth').textContent = monthNames[currentDate.month - 1];
            document.getElementById('currentMonthNp').textContent = monthNamesNp[currentDate.month - 1];
        }

        document.getElementById('prevMonth').onclick = () => {
            if (currentDate.month > 1) {
                currentDate.month--;
            } else {
                currentDate.year--;
                currentDate.month = 12;
                fetchCalendarData();
                return;
            }
            renderCalendar();
        };

        document.getElementById('nextMonth').onclick = () => {
            if (currentDate.month < 12) {
                currentDate.month++;
            } else {
                currentDate.year++;
                currentDate.month = 1;
                fetchCalendarData();
                return;
            }
            renderCalendar();
        };

        fetchCalendarData();
    </script>
</body>
</html>