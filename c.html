


<style>
    .calendar-container {
        max-width: 1200px;
        margin: 2rem auto;
    }
    
    .calendar-header {
        background-color: #f8f9fa;
        padding: 1rem;
        border-radius: 8px 8px 0 0;
    }
    
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background-color: #dee2e6;
        border: 1px solid #dee2e6;
    }
    
    .calendar-day {
        background-color: white;
        aspect-ratio: 1;
        padding: 0.5rem;
        position: relative;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    
    .calendar-day:hover {
        background-color: #f8f9fa;
    }
    
    .day-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 0.25rem;
    }
    
    .bs-date {
        font-weight: bold;
        font-size: 1.1rem;
        color: #1a73e8;
    }
    
    .ad-date {
        color: #666;
        font-size: 0.7rem;
    }
    
    .event-indicators {
        display: flex;
        gap: 2px;
        margin-top: 0.25rem;
    }
    
    .event-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        margin-right: 2px;
    }
    
    .event-dot.holiday {
        background-color: #dc3545;
    }
    
    .event-dot.normal {
        background-color: #1a73e8;
    }
    
    .today {
        background-color: #e8f4f8;
    }
    
    .weekend {
        background-color: #f8f9fa;
    }
    
    .holiday-cell {
        background-color: #fff5f5;
    }
    
    .weekday-header {
        background-color: #f8f9fa;
        padding: 0.5rem;
        text-align: center;
        font-weight: 500;
        color: #666;
    }

    /* Modal styles */
    .event-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        width: 90%;
        max-width: 500px;
        max-height: 80vh;
        overflow-y: auto;
    }

    .event-list {
        margin-top: 1rem;
    }

    .event-item {
        padding: 0.5rem;
        margin-bottom: 0.5rem;
        border-radius: 4px;
        display: flex;
        align-items: center;
    }

    .event-item.holiday {
        background-color: #fff5f5;
        border-left: 3px solid #dc3545;
    }

    .event-item.normal {
        background-color: #f0f7ff;
        border-left: 3px solid #1a73e8;
    }

    .loading {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    .calendar-header-text {
text-align: center;
color: #4A90E2;
font-size: 24px;
font-weight: bold;
}
</style>


<h1 class="calendar-header-text">Our Calendar</h1>

<div class="container calendar-container">
    <div class="calendar-header d-flex justify-content-between align-items-center mb-3">
        <button class="btn btn-outline-primary" id="prevMonth">&lt; Previous</button>
        <h2 class="mb-0" id="currentMonth"></h2>
        <button class="btn btn-outline-primary" id="nextMonth">Next &gt;</button>
    </div>
    
    <div class="calendar-grid">
        <div class="weekday-header">Sun</div>
        <div class="weekday-header">Mon</div>
        <div class="weekday-header">Tue</div>
        <div class="weekday-header">Wed</div>
        <div class="weekday-header">Thu</div>
        <div class="weekday-header">Fri</div>
        <div  class="weekday-header">Sat</div>
    </div>
    <div id="calendarBody" class="calendar-grid"></div>
</div>

<!-- Event Modal -->
<div id="eventModal" class="event-modal">
    <div class="modal-content">
        <div class="d-flex justify-content-between align-items-center">
            <h4 id="modalDate" class="mb-0"></h4>
            <button class="btn-close" onclick="closeModal()"></button>
        </div>
        <div id="eventList" class="event-list"></div>
    </div>
</div>

<div id="loading" class="loading d-none">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>

<script>
    class Calendar {
        constructor() {
            this.currentBsYear = 2081;
            this.currentBsMonth = 8; // Mangsir
            this.calendarData = null;
            
            this.initializeCalendar();
            this.attachEventListeners();
        }

        async initializeCalendar() {
            const loading = document.getElementById('loading');
            loading.classList.remove('d-none');
            
            await this.fetchCalendarData();
            this.renderCalendar();
            
            loading.classList.add('d-none');
        }

        attachEventListeners() {
            document.getElementById('prevMonth').addEventListener('click', () => {
                this.currentBsMonth--;
                if (this.currentBsMonth < 1) {
                    this.currentBsMonth = 12;
                    this.currentBsYear--;
                }
                this.initializeCalendar();
            });

            document.getElementById('nextMonth').addEventListener('click', () => {
                this.currentBsMonth++;
                if (this.currentBsMonth > 12) {
                    this.currentBsMonth = 1;
                    this.currentBsYear++;
                }
                this.initializeCalendar();
            });
        }

        async fetchCalendarData() {
            try {
                const response = await fetch("https://api.saralpatro.com/graphql", {
                    credentials: "omit",
                    headers: {
                        "Accept": "application/json",
                        "Content-Type": "application/json",
                    },
                    method: "POST",
                    body: JSON.stringify({
                        query: `
                            {
                                dates(bsYear: ${this.currentBsYear}, bsMonth: ${this.currentBsMonth}) {
                                    bsDay
                                    bsMonth
                                    bsYear
                                    adDay
                                    adMonth
                                    adYear
                                    weekday
                                    isHoliday
                                    events {
                                        strEn
                                        strNp
                                        isHoliday
                                    }
                                }
                            }
                        `
                    })
                });
                
                const data = await response.json();
                this.calendarData = data.data.dates;
            } catch (error) {
                console.error('Error fetching calendar data:', error);
                this.calendarData = [];
            }
        }

        getNepaliMonth(month) {
            const nepaliMonths = [
                'Baisakh', 'Jestha', 'Ashar', 'Shrawan', 
                'Bhadra', 'Ashwin', 'Kartik', 'Mangsir',
                'Poush', 'Magh', 'Falgun', 'Chaitra'
            ];
            return nepaliMonths[month - 1];
        }

        renderCalendar() {
            if (!this.calendarData || this.calendarData.length === 0) return;

            document.getElementById('currentMonth').textContent = 
                `${this.getNepaliMonth(this.currentBsMonth)} ${this.currentBsYear}`;

            const calendarBody = document.getElementById('calendarBody');
            calendarBody.innerHTML = '';

            // Find the first day of the month
            const firstDayData = this.calendarData[0];
            const startingDay = firstDayData.weekday;

            // Create empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calendar-day';
                calendarBody.appendChild(emptyCell);
            }

            // Render actual days
            this.calendarData.forEach(dayData => {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                
                if (dayData.isHoliday) {
                    dayCell.classList.add('holiday-cell');
                }
                
                if (dayData.weekday === 0 || dayData.weekday === 6) {
                    dayCell.classList.add('weekend');
                }

                // Create date display
                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-header';
                dayHeader.innerHTML = `
                    <span class="bs-date">${dayData.bsDay}</span>
                    <span class="ad-date">${dayData.adMonth}/${dayData.adDay}</span>
                `;
                dayCell.appendChild(dayHeader);

                // Add event indicators
                if (dayData.events && dayData.events.length > 0) {
                    const indicators = document.createElement('div');
                    indicators.className = 'event-indicators';
                    
                    const holidayEvents = dayData.events.filter(e => e.isHoliday);
                    const normalEvents = dayData.events.filter(e => !e.isHoliday);
                    
                    if (holidayEvents.length > 0) {
                        const dot = document.createElement('div');
                        dot.className = 'event-dot holiday';
                        indicators.appendChild(dot);
                    }
                    
                    if (normalEvents.length > 0) {
                        const dot = document.createElement('div');
                        dot.className = 'event-dot normal';
                        indicators.appendChild(dot);
                    }
                    
                    dayCell.appendChild(indicators);

                    // Add click event to show modal
                    dayCell.addEventListener('click', () => this.showEvents(dayData));
                }

                calendarBody.appendChild(dayCell);
            });
        }

        showEvents(dayData) {
            const modal = document.getElementById('eventModal');
            const modalDate = document.getElementById('modalDate');
            const eventList = document.getElementById('eventList');

            modalDate.textContent = `${this.getNepaliMonth(dayData.bsMonth)} ${dayData.bsDay}, ${dayData.bsYear}`;
            eventList.innerHTML = '';

            if (dayData.events && dayData.events.length > 0) {
                dayData.events.forEach(event => {
                    const eventDiv = document.createElement('div');
                    eventDiv.className = `event-item ${event.isHoliday ? 'holiday' : 'normal'}`;
                    eventDiv.textContent = event.strEn;
                    eventList.appendChild(eventDiv);
                });
            } else {
                eventList.innerHTML = '<p class="text-muted">No events for this day</p>';
            }

            modal.style.display = 'flex';
        }
    }

    // Global function to close modal
    function closeModal() {
        document.getElementById('eventModal').style.display = 'none';
    }

    // Close modal when clicking outside
    document.getElementById('eventModal').addEventListener('click', (e) => {
        if (e.target.id === 'eventModal') {
            closeModal();
        }
    });

    // Initialize calendar when page loads
    document.addEventListener('DOMContentLoaded', () => {
        new Calendar();
    });
</script>
